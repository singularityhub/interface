{% extends "main/main.html" %}


{% block sidebar %}
<div style="margin-top:55px" class="row">
</div>
<style>
.selected-row { background-color: skyblue !important; }
</style>
{% endblock %}

{% block main %}

<div class="row">
    <div class="col-md-12">
        <h3>{{ endpoint.display_name }}</h3>
    </div>
</div>

{% if paths %}
<div class="row">
    <div class="col-md-7">
        <input type="text" id="searchInput" onkeyup="tableSearch()" style="margin-bottom:10px" placeholder="Search names...">
        <p class="alert alert-info" id="message-activate" style="display:none;padding: 8px; margin-left: 10px"></p>
        <button type="button" style="float:right; margin-bottom:8px; display:none" 
                id="transfer-button" class="btn btn-primary"><i class="fa fa-arrow-right"></i></button>
        <table id="label_table" class="table table-hover table-bordered" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th></th>
                <th>group</th>
                <th>name</th>
                <th>permissions</th>
                <th>size</th>
                <th>last_modified</th>
                <th>user</th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <th></th>
                <th>group</th>
                <th>name</th>
                <th>permissions</th>
                <th>size</th>
                <th>last_modified</th>
                <th>user</th>
            </tr>
        </tfoot>
        <tbody>
        {% for item in paths %}
            <tr class="tableRow {% if item.type != 'dir' %}clickable-row{% endif %}">
                <td data-search="{{ item.type }}"><i style="color:{% if item.type == 'file' %}cornflowerblue{% else %}darkorange{% endif %}" 
                    class="fa {% if item.type == 'file' %}fa-file{% else %}fa-folder{% endif %}"></i></td>
                <td data-search="group,{{ item.group }}">{{ item.group }}</td>
                <td data-search="name,{{ item.name }}">{% if item.type == 'dir' %}
                   <a href="#" class="folder" data-name="{{ item.name }}">{% endif %}
                   {{ item.name }}</td>{% if item.type == 'dir' %}</a>{% endif %}
                <td data-search="permissions,{{ item.permissions }}">{{ item.permissions }}</td>
                <td data-search="user,{{ item.size }}">{{ item.size }}</td>
                {% set modified = item.last_modified.split(' ') %}
                <td data-search="modified date,{{ item.last_modified }}">{{ modified[0] }}</td>
                <td data-search="user,{{ item.user }}">{{ item.user }}</td>
            </tr>
        {% endfor %}
        </tbody>
        </table>
    </div>
    <div class="col-md-4">
        <button type="button" style="margin-bottom:10px" class="btn btn-primary"><i class="fa fa-arrow-left"></i></button>
        <div class="input-group">
            <select multiple class="form-control" style="height:200px" id="container" name="container">
            {% for container in images %}    
            <option value="{{ container.name }}">{{ container.uri }}</option>
            {% endfor %}
            </select>   
         </span>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
    <script type="text/javascript">

         $('.clickable-row').click(function() {
             $(this).addClass('selected-row').siblings().removeClass('selected-row');
             $("#transfer-button").show();
         });

        // If there is an error, the user will be shown by appending here
        {% if message %}
            $('#message-activate').append("{{ message }}");
            $('#message-activate').show();
        {% endif %}

        function tableSearch() {

            // https://www.w3schools.com/howto/howto_js_filter_table.asp

            var input, filter, table, tr, td, i;
            input = document.getElementById("searchInput");
            filter = input.value.toUpperCase();
            table = document.getElementById("label_table");
            tr = table.getElementsByClassName("tableRow");

            for (i = 0; i < tr.length; i++) {
                $.each(tr[i].children, function(e, child){
                    text = $(child).attr('data-search');
                    if (text.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                   } else {
                        tr[i].style.display = "none";
                   }
                })                
            }
         }
    </script>
{% endblock %}
